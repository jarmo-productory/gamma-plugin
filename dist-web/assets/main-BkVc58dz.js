(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();async function k(){const r="pk_test_b3V0Z29pbmctbWFydGVuLTI0LmNsZXJrLmFjY291bnRzLmRldiQ";if(!window.Clerk)try{await new Promise((t,s)=>{const o=document.createElement("script");o.src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js",o.async=!0,o.onload=t,o.onerror=s,document.head.appendChild(o)})}catch(t){return console.error("[Auth] Failed to load Clerk SDK:",t),null}try{return await window.Clerk.load({publishableKey:r}),console.log("[Auth] Clerk SDK loaded successfully"),window.Clerk}catch(t){return console.error("[Auth] Failed to initialize Clerk:",t),null}}function f(r){const s=b("pk_test_b3V0Z29pbmctbWFydGVuLTI0LmNsZXJrLmFjY291bnRzLmRldiQ");return s?(console.log("[Auth] Using real Clerk hosted sign-in:",s),`https://${s}/sign-in?redirect_url=${encodeURIComponent(r)}`):(console.warn("[Auth] Could not extract Clerk domain from key"),null)}function b(r){try{if(r.startsWith("pk_test_")){const t=r.replace("pk_test_",""),s=atob(t);if(console.log("[Auth] Decoded clerk key:",s),s.includes(".clerk.accounts.dev")){const o=s.match(/([a-z0-9-]+)\.clerk\.accounts\.dev/);if(o){const n=`${o[1]}.accounts.dev`;return console.log("[Auth] Extracted hosted domain:",n),n}}}else if(r.startsWith("pk_live_")){const t=r.replace("pk_live_",""),o=atob(t).match(/([a-z0-9-]+)\.clerk\.accounts\.com/);if(o)return`${o[1]}.accounts.com`}}catch(t){console.warn("[Auth] Could not extract Clerk domain:",t)}return null}function e(r,t={},s=[]){const o=document.createElement(r);return Object.entries(t).forEach(([n,i])=>{n==="style"&&typeof i=="object"?Object.assign(o.style,i):n.startsWith("on")&&typeof i=="function"?o.addEventListener(n.slice(2).toLowerCase(),i):o.setAttribute(n,i)}),(Array.isArray(s)?s:[s]).forEach(n=>{typeof n=="string"?o.appendChild(document.createTextNode(n)):n&&o.appendChild(n)}),o}function g(r){return new URL(window.location.href).searchParams.get(r)}async function y(r){const t="dev-session-token";console.log("[Auth] Using hardcoded dev token for device linking in local development");const s={"Content-Type":"application/json"};s.Authorization=`Bearer ${t}`;const o=await fetch("/api/devices/link",{method:"POST",headers:s,body:JSON.stringify({code:r}),credentials:"include"});if(!o.ok)throw new Error(`link failed: ${o.status}`);return o.json()}async function C(r){const t=g("code"),s=g("__session"),o=g("__clerk_db_jwt"),n=e("div",{style:{padding:"20px",maxWidth:"560px"}},[e("h1",{},"ðŸ” Device Linking"),e("p",{},t?`Linking device with code: ${t}`:"Ready to link your extension"),e("div",{id:"status",style:{margin:"12px 0"}}),e("div",{style:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",marginBottom:"15px"}},[e("h3",{},"1ï¸âƒ£ Sign In"),s||o?e("p",{style:{color:"green"}},"âœ… Authenticated successfully with Clerk"):e("button",{id:"clerk-signin-btn",style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Sign in with Clerk")]),e("div",{style:{border:"1px solid #ddd",padding:"15px",borderRadius:"8px",marginBottom:"15px"}},[e("h3",{},"2ï¸âƒ£ Link Device"),e("div",{style:{display:"flex",gap:"8px",alignItems:"center",marginTop:"10px"}},[e("input",{id:"code-input",placeholder:"Enter pairing code",value:t||"",style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px",flex:"1"}}),e("button",{id:"link-btn",style:{padding:"8px 16px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Link Device")])]),e("hr"),e("div",{},[e("button",{id:"mock-login-btn",style:{padding:"5px 10px",fontSize:"12px"}},"Mock Login (Dev)"),e("small",{style:{marginLeft:"8px"}},"(For development only)")])]);r.innerHTML="",r.appendChild(n);const i=n.querySelector("#status"),u=n.querySelector("#code-input"),h=n.querySelector("#link-btn"),m=n.querySelector("#mock-login-btn"),p=n.querySelector("#clerk-signin-btn");p&&p.addEventListener("click",()=>{const d=window.location.href,a=f(d);a?(i.textContent="Redirecting to Clerk...",window.location.href=a):i.textContent="âŒ Clerk not configured"}),h.addEventListener("click",async()=>{const d=u.value.trim();if(!d){i.textContent="âŒ Please enter a pairing code";return}try{i.textContent="Linking device...",await y(d),i.textContent="âœ… Device linked successfully! You can close this page."}catch(a){i.textContent=`âŒ Link failed: ${(a==null?void 0:a.message)||a}`}}),m.addEventListener("click",()=>{localStorage.setItem("clerk_session_token","dev-session-token"),i.textContent="ðŸ”§ Dev token set. Try linking device now."});const c=g("__session"),l=g("__clerk_db_jwt");if(c||l){console.log("[Auth] Authentication token received:",l?"Clerk JWT":"Session token"),l?(localStorage.setItem("clerk_jwt_token",l),localStorage.setItem("clerk_session_token","dev-session-token")):localStorage.setItem("clerk_session_token",c);const d=u.value.trim();if(d){i.textContent="Authenticated! Auto-linking device...";try{await y(d),i.textContent="âœ… Device linked successfully! You can close this page."}catch(a){i.textContent=`âŒ Auto-link failed: ${(a==null?void 0:a.message)||a}`}}else i.textContent="âœ… Authenticated with Clerk! Enter pairing code to link device."}}async function x(r){const t=g("code"),s=g("__clerk_db_jwt"),o=localStorage.getItem("clerk_session_token"),n=localStorage.getItem("clerk_jwt_token"),u=s||(o||n);if(console.log("[Dashboard] Pairing code:",t,"Authenticated:",u),t&&!u){const c=f(window.location.origin+"/sign-in?code="+t);if(c){console.log("[Dashboard] Auto-redirecting to Clerk for authentication with pairing code"),window.location.href=c;return}}const h=e("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}},[e("div",{style:{background:"white",padding:"60px 40px",borderRadius:"20px",boxShadow:"0 20px 60px rgba(0,0,0,0.1)",textAlign:"center",maxWidth:"480px",width:"100%"}},[e("div",{style:{fontSize:"60px",marginBottom:"20px"}},t?"ðŸ”—":"ðŸ“Š"),e("h1",{style:{fontSize:"32px",marginBottom:"16px",color:"#2d3748"}},t?"Device Pairing":"Gamma Timetable"),e("p",{style:{fontSize:"18px",color:"#718096",marginBottom:"40px"}},t?"Connecting your Chrome extension...":"Transform your Gamma presentations into beautiful timetables"),e("div",{id:"auth-section",style:{marginBottom:"30px"}},[t&&u?e("div",{style:{textAlign:"center"}},[e("div",{style:{fontSize:"16px",color:"#38a169",marginBottom:"16px"}},"âœ… Authenticated with Clerk"),e("div",{style:{fontSize:"16px",color:"#3182ce",marginBottom:"16px"}},"ðŸ”„ Pairing device automatically..."),e("div",{style:{width:"32px",height:"32px",border:"3px solid #e2e8f0",borderTop:"3px solid #3182ce",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto"}})]):e("button",{id:"main-login-btn",style:{background:"#5a67d8",color:"white",border:"none",padding:"16px 32px",borderRadius:"12px",fontSize:"16px",fontWeight:"600",cursor:"pointer",width:"100%",transition:"all 0.2s"}},"ðŸ” Sign In with Clerk")]),e("div",{id:"dashboard-status",style:{fontSize:"14px",color:"#a0aec0"}},t?`Pairing code: ${t}`:"Ready to connect"),e("div",{style:{marginTop:"40px",textAlign:"left"}},[e("h3",{style:{fontSize:"18px",marginBottom:"20px",color:"#2d3748"}},"Features"),e("div",{style:{display:"grid",gap:"12px"}},[e("div",{style:{display:"flex",alignItems:"center",gap:"12px"}},[e("span",{},"âœ…"),e("span",{style:{color:"#4a5568"}},"Chrome extension for Gamma.app")]),e("div",{style:{display:"flex",alignItems:"center",gap:"12px"}},[e("span",{},"ðŸ”„"),e("span",{style:{color:"#4a5568"}},"Cross-device synchronization")]),e("div",{style:{display:"flex",alignItems:"center",gap:"12px"}},[e("span",{},"ðŸ“Š"),e("span",{style:{color:"#4a5568"}},"Export to Excel & PDF")])])])])]);if(!document.querySelector("#spinner-css")){const c=document.createElement("style");c.id="spinner-css",c.textContent=`
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    `,document.head.appendChild(c)}if(r.innerHTML="",r.appendChild(h),t&&u){const c=document.getElementById("dashboard-status");setTimeout(async()=>{try{console.log("[Dashboard] Starting auto-pairing with code:",t),c.textContent="Connecting to extension...",await y(t);const l=document.getElementById("auth-section");l.innerHTML="",l.appendChild(e("div",{style:{textAlign:"center"}},[e("div",{style:{fontSize:"64px",marginBottom:"20px"}},"âœ…"),e("div",{style:{fontSize:"20px",color:"#38a169",marginBottom:"16px"}},"Device Connected Successfully!"),e("div",{style:{fontSize:"16px",color:"#4a5568"}},"Your Chrome extension is now linked to your account.")])),c.textContent="Extension connected and ready to sync"}catch(l){console.error("[Dashboard] Auto-pairing failed:",l);const d=document.getElementById("auth-section");d.innerHTML="",d.appendChild(e("div",{style:{textAlign:"center"}},[e("div",{style:{fontSize:"64px",marginBottom:"20px"}},"âŒ"),e("div",{style:{fontSize:"20px",color:"#e53e3e",marginBottom:"16px"}},"Pairing Failed"),e("div",{style:{fontSize:"16px",color:"#4a5568",marginBottom:"20px"}},l.message||"Could not connect to extension"),e("button",{id:"retry-btn",style:{background:"#3182ce",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",cursor:"pointer"}},"Try Again")])),c.textContent="Connection failed - please try again";const a=document.getElementById("retry-btn");a&&a.addEventListener("click",()=>window.location.reload())}},1e3);return}const m=document.getElementById("main-login-btn"),p=document.getElementById("dashboard-status");m&&p&&m.addEventListener("click",async()=>{p.textContent="Initializing authentication...";const c=f(window.location.origin+"/sign-in");if(c){p.textContent="Redirecting to Clerk sign-in...",window.location.href=c;return}const l=await k();if(l)try{p.textContent="Opening Clerk sign-in modal...",await l.openSignIn({redirectUrl:window.location.origin+"/sign-in",afterSignInUrl:window.location.origin+"/sign-in"})}catch(d){console.error("[Auth] Clerk SDK sign-in failed:",d),p.textContent="Authentication failed. Please check console for details."}else p.textContent="Clerk authentication not properly configured."})}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("app");if(!r)return;const t=new URL(window.location.href),s=location.pathname==="/sign-in"||location.pathname.endsWith("/sign-in"),o=!!t.searchParams.get("code"),n=!!t.searchParams.get("__clerk_db_jwt"),i=!!t.searchParams.get("__session");s&&(o||n||i)?x(r):s&&!o?C(r):x(r)});
