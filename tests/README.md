# Testing Documentation - Gamma Timetable Extension

## Overview
Comprehensive testing suite for the Gamma Timetable Extension web application, including unit tests, E2E tests, and quality assurance infrastructure.

## Test Structure

### Unit Tests (Vitest)
- **Location**: `packages/web/src/components/ui/*.test.tsx`
- **Framework**: Vitest + React Testing Library + Happy DOM
- **Coverage**: UI components, utilities, and business logic
- **Command**: `npm run test:run` (from packages/web)
- **Status**: ‚úÖ 4/4 tests passing

**Example Tests:**
- Button component variants and states
- Form validation logic
- Utility functions

### End-to-End Tests (Playwright) - CONSOLIDATED
- **Location**: `tests/e2e/` (3 files, ~500 lines total)
- **Framework**: Playwright
- **Browser**: Chromium (configurable)
- **Command**: `npm run test:e2e` (from project root)
- **Status**: ‚úÖ Comprehensive test suite operational

**Test Suites (Consolidated):**

#### 1. Core Authentication Flow (`auth-flow.spec.ts`)
- Homepage loading and basic page structure
- Login/signup functionality accessibility
- Dashboard protection validation
- Real credential authentication testing
- Form structure and element analysis
- Authentication callback route testing

#### 2. User Experience & Advanced Authentication (`user-experience.spec.ts`)
- Complete user journey simulation with real credentials
- Google OAuth integration detection
- Form validation and error handling
- Tab interface and UI transitions
- Authentication state persistence testing

#### 3. API Integration & Route Testing (`api-integration.spec.ts`)
- Database connection and API endpoint testing
- Authentication route accessibility
- Network request monitoring during auth flows
- Authentication state detection
- Error handling and edge case testing
- Performance and loading state validation

## Test Credentials
- **Email**: `koolitus@productory.eu`
- **Password**: `Productory7819`
- **Purpose**: Testing actual authentication flow

## Key Findings from E2E Tests

### ‚úÖ Working Components
1. **Page Routing**: All routes (`/login`, `/signup`, `/dashboard`, `/auth/*`) are accessible
2. **Form Structure**: Login/signup forms render with proper input fields
3. **UI Components**: Tab-based authentication interface working
4. **Form Validation**: Client-side validation implemented

### ‚ö†Ô∏è Implementation Status (As of Phase 3 Development)
1. **Authentication Flow**: In development - forms submit but redirect logic incomplete
2. **Dashboard Protection**: Routes exist but authentication guards may need refinement
3. **Error Handling**: Basic error states detected but may need enhancement
4. **OAuth Integration**: Google OAuth button detected but integration testing needed

### üîç Technical Analysis
- **No external auth scripts detected** (Clerk/Auth0 scripts not found)
- **Custom authentication implementation** likely in use
- **Supabase integration** configured (database connection confirmed)
- **Form submission timeout** indicates async processing

## Running Tests

### Prerequisites
```bash
# Install dependencies
npm install

# Ensure development server is running for E2E tests
cd packages/web && npm run dev
```

### Unit Tests
```bash
cd packages/web
npm run test        # Watch mode
npm run test:run    # Single run
npm run test:ui     # Visual test UI
```

### E2E Tests
```bash
# Run all E2E tests
npm run test:e2e

# Run specific test file
npx playwright test tests/e2e/auth-flow.spec.ts

# Run with visible browser
npx playwright test --headed

# View test results
npx playwright show-report
```

### Quality Checks
```bash
# ESLint (with Next.js rules)
npm run lint

# TypeScript compilation
npx tsc --noEmit

# Production build test
npm run build
```

## Test Configuration

### Vitest Configuration (`packages/web/vitest.config.ts`)
```typescript
export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'happy-dom',
    setupFiles: ['./src/test/setup.ts'],
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
})
```

### Playwright Configuration (`playwright.config.ts`)
```typescript
export default defineConfig({
  testDir: './tests/e2e',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
  },
  webServer: {
    command: 'cd packages/web && npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
})
```

## Screenshots and Reports
- **Screenshots**: Automatically saved to `test-results/` during E2E tests
- **HTML Reports**: Generated by Playwright, viewable with `npx playwright show-report`
- **Coverage Reports**: Available through Vitest coverage tool

## Development Workflow

### Adding New Tests
1. **Unit Tests**: Create `.test.tsx` files alongside components
2. **E2E Tests**: Add `.spec.ts` files to `tests/e2e/`
3. **Follow Patterns**: Use existing tests as templates

### Test-Driven Development
1. Write failing test first
2. Implement minimum code to pass
3. Refactor while maintaining green tests
4. Run full test suite before commits

### CI/CD Integration
Tests are configured to run in CI environments with:
- Headless browser mode for E2E tests
- Coverage reporting
- Quality gates enforcement

## Troubleshooting

### Common Issues
1. **Timeout Errors**: Increase timeout or add proper wait conditions
2. **Element Not Found**: Verify selectors match actual DOM structure
3. **Test Server**: Ensure development server is running for E2E tests

### Debug Mode
```bash
# Run with debug console
npx playwright test --debug

# Slow motion for visual debugging
npx playwright test --headed --slowMo=1000
```

## Next Steps for Authentication Testing

1. **Complete Authentication Integration**: Once Claude III finishes Phase 3
2. **Real OAuth Flow Testing**: Test Google OAuth with actual flow
3. **Session Management Testing**: Verify login persistence
4. **Dashboard Content Testing**: Test authenticated user features
5. **Logout Flow Testing**: Complete user session lifecycle

The testing infrastructure is ready to support ongoing development and provides comprehensive feedback on authentication implementation progress.