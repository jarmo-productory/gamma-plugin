(function(r,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(r=typeof globalThis<"u"?globalThis:r||self,i(r.SharedComponents={}))})(this,function(r){"use strict";const i=o=>o&&typeof o.id=="string"&&typeof o.title=="string"&&Array.isArray(o.content),g=o=>o&&typeof o.id=="string"&&typeof o.duration=="number",u={enableCloudSync:!1,syncDebounceMs:500,maxRetries:3,dataVersion:1};class l{constructor(e={}){this.syncQueue=[],this.config={...u,...e}}async save(e,t){try{const n={version:this.config.dataVersion,data:t,timestamp:new Date,presentation_url:this.extractPresentationUrl(e)};await this.chromeStorageSave(e,n),this.config.enableCloudSync&&this.addToSyncQueue(e,t,"save")}catch(n){throw console.error("[StorageManager] Save failed:",n),n}}async load(e){try{const t=await this.chromeStorageLoad(e);if(!t)return;if(!this.isVersionedData(t))return console.log("[StorageManager] Loading legacy data for key:",e),t;const n=t;return n.version!==this.config.dataVersion&&console.log(`[StorageManager] Data version mismatch for key ${e}: ${n.version} vs ${this.config.dataVersion}`),n.data}catch(t){throw console.error("[StorageManager] Load failed:",t),t}}async remove(e){try{await this.chromeStorageRemove(e),this.config.enableCloudSync&&this.addToSyncQueue(e,null,"remove")}catch(t){throw console.error("[StorageManager] Remove failed:",t),t}}async clear(){try{await this.chromeStorageClear(),this.syncQueue=[]}catch(e){throw console.error("[StorageManager] Clear failed:",e),e}}chromeStorageSave(e,t){return new Promise((n,a)=>{chrome.storage.local.set({[e]:t},()=>{if(chrome.runtime.lastError)return a(chrome.runtime.lastError);n()})})}chromeStorageLoad(e){return new Promise((t,n)=>{chrome.storage.local.get(e,a=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t(a[e])})})}chromeStorageRemove(e){return new Promise((t,n)=>{chrome.storage.local.remove(e,()=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t()})})}chromeStorageClear(){return new Promise((e,t)=>{chrome.storage.local.clear(()=>{if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e()})})}isVersionedData(e){return e&&typeof e=="object"&&"version"in e&&"data"in e&&"timestamp"in e}extractPresentationUrl(e){const t=e.match(/^timetable-(.+)$/);return t?t[1]:void 0}addToSyncQueue(e,t,n){const a={key:e,data:t,operation:n,timestamp:new Date,attempts:0};this.syncQueue.push(a),this.scheduleSyncProcess()}scheduleSyncProcess(){this.syncTimer&&clearTimeout(this.syncTimer),this.syncTimer=setTimeout(()=>{this.processSyncQueue()},this.config.syncDebounceMs)}async processSyncQueue(){if(!(!this.config.enableCloudSync||this.syncQueue.length===0)){console.log(`[StorageManager] Processing sync queue: ${this.syncQueue.length} items`);for(const e of this.syncQueue)console.log("[StorageManager] Sync queue item:",e);this.syncQueue=[]}}getSyncQueueStatus(){return{count:this.syncQueue.length,items:[...this.syncQueue]}}updateConfig(e){this.config={...this.config,...e}}}const s=new l;function m(o,e){return s.save(o,e)}function f(o){return s.load(o)}function d(o,e){let t;return function(...n){const a=this;clearTimeout(t),t=setTimeout(()=>o.apply(a,n),e)}}class y{constructor(){}async isAuthenticated(){return!1}async login(e,t){throw new Error("Authentication not yet implemented")}async logout(){throw new Error("Authentication not yet implemented")}async refreshToken(){throw new Error("Authentication not yet implemented")}async getCurrentUser(){return null}}const h={features:{cloudSync:!1,authentication:!1,webDashboard:!1,realTimeSync:!1,autoSync:!1,offlineMode:!0,exportFeatures:!0},version:{current:"0.0.5",minimumForCloud:"0.1.0"}};class c{constructor(e){this.config={...h,...e}}getFeatureFlag(e){return this.config.features[e]}setFeatureFlag(e,t){this.config.features[e]=t}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}isFeatureEnabled(e){return this.getFeatureFlag(e)}static getEnvironmentConfig(){var t;return{api:{baseUrl:typeof process<"u"&&((t=process.env)==null?void 0:t.NODE_ENV)==="development"?"http://localhost:3000":"https://api.gamma-timetable.app",timeout:5e3}}}}const S=new c(c.getEnvironmentConfig()),p="0.0.5",v=()=>{console.log("Shared package initialized")};r.AuthManager=y,r.ConfigManager=c,r.DEFAULT_CONFIG=h,r.DEFAULT_STORAGE_CONFIG=u,r.SHARED_VERSION=p,r.StorageManager=l,r.config=S,r.debounce=d,r.defaultStorageManager=s,r.initializeShared=v,r.isSlide=i,r.isTimetableItem=g,r.loadData=f,r.saveData=m,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
