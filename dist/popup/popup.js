import{a as i}from"../assets/index.js";document.addEventListener("DOMContentLoaded",function(){c()});async function c(){r(),await g()}function r(){const t=document.getElementById("open-sidebar-btn"),e=document.getElementById("sidebar-status");t&&(t.onclick=async function(){if(chrome.sidePanel&&chrome.sidePanel.open)try{let[n]=await chrome.tabs.query({active:!0,currentWindow:!0});await chrome.sidePanel.open({windowId:n.windowId})}catch(n){e&&(e.textContent="Failed to open side panel: "+n)}else e&&(e.textContent="Side Panel API not available in this version of Chrome.")})}async function g(){const t=i.shouldShowAuthUI(),e=document.getElementById("auth-section"),n=document.getElementById("auth-status"),s=document.getElementById("auth-status-text"),o=document.getElementById("auth-buttons"),l=document.getElementById("login-btn"),a=document.getElementById("logout-btn");if(!e||!n||!s||!o||!l||!a){console.log("[Popup] Auth UI elements not found");return}t?(e.style.display="block",n.style.display="block",o.style.display="flex"):(e.style.display="none",console.log("[Popup] Authentication UI hidden (Sprint 0)"));const d=i.onAuthStateChange(u=>{m(u)});l.addEventListener("click",y),a.addEventListener("click",p),window.addEventListener("beforeunload",()=>{d()})}function m(t){const e=document.getElementById("auth-status"),n=document.getElementById("auth-status-text"),s=document.getElementById("login-btn"),o=document.getElementById("logout-btn");!e||!n||!s||!o||(e.className=`auth-status ${t.isAuthenticated?"authenticated":"unauthenticated"}`,t.isLoading?(n.textContent="Loading...",s.disabled=!0,o.disabled=!0):t.isAuthenticated&&t.user?(n.textContent=`Signed in as ${t.user.email}`,s.style.display="none",o.style.display="inline-block",s.disabled=!1,o.disabled=!1):(n.textContent="Guest Mode - Not signed in",s.style.display="inline-block",o.style.display="none",s.disabled=!1,o.disabled=!1),t.lastError&&console.error("[Popup] Auth error:",t.lastError))}async function y(){try{const t=document.getElementById("sidebar-status");t&&(t.style.color="blue",t.textContent="Authentication will be available in Sprint 1"),console.log("[Popup] Login attempted - will be implemented in Sprint 1")}catch(t){console.error("[Popup] Login failed:",t);const e=document.getElementById("sidebar-status");e&&(e.style.color="red",e.textContent="Login failed: "+t.message)}}async function p(){try{await i.logout(),console.log("[Popup] User logged out");const t=document.getElementById("sidebar-status");t&&(t.style.color="green",t.textContent="Logged out successfully")}catch(t){console.error("[Popup] Logout failed:",t);const e=document.getElementById("sidebar-status");e&&(e.style.color="red",e.textContent="Logout failed: "+t.message)}}
