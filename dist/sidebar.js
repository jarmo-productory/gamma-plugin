(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=n(e);fetch(e.href,r)}})();function p(i){const t=String(i.getHours()).padStart(2,"0"),n=String(i.getMinutes()).padStart(2,"0");return`${t}:${n}`}function g(i){const[t,n]=i.split(":").map(Number),o=new Date;return o.setHours(t,n,0,0),o}function h(i,t={}){const{startTime:n="09:00",defaultDuration:o=5}=t,e=[];let r=g(n),s=0;return i.forEach(a=>{const l=new Date(r),d=o;r.setMinutes(r.getMinutes()+d),s+=d,e.push({id:a.id,title:a.title,content:a.content,startTime:p(l),duration:d,endTime:p(r)})}),{startTime:n,items:e,totalDuration:s}}function y(i){let t=`Item,Start Time,Duration (min),End Time
`;return i.items.forEach(n=>{const o=n.title.replace(/"/g,'""');t+=`"${o}",${n.startTime},${n.duration},${n.endTime}
`}),t}function E(i,t,n="text/csv;charset=utf-8;"){const o=new Blob([t],{type:n}),e=document.createElement("a"),r=URL.createObjectURL(o);e.setAttribute("href",r),e.setAttribute("download",i),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function T(i,t){return new Promise((n,o)=>{chrome.storage.local.set({[i]:t},()=>{if(chrome.runtime.lastError)return o(chrome.runtime.lastError);n()})})}function v(i){return new Promise((t,n)=>{chrome.storage.local.get(i,o=>{if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t(o[i])})})}function S(i,t){let n;return function(...o){const e=this;clearTimeout(n),n=setTimeout(()=>i.apply(e,o),t)}}const C="0.1.0";let u=!1,m=[],c=null;const b=()=>`timetable-${window.location.href}`;function $(i=[]){const t=i.length;let n=i[0]?JSON.stringify(i[0],null,2):"N/A";return`
    <div class="debug-info">
      <strong>Debug Info</strong><br>
      Slides Detected: <strong>${t}</strong><br>
      Connected: <span style="color:${u?"green":"red"};font-weight:bold;">${u?"Yes":"No"}</span><br>
      <details><summary>First Slide Preview</summary><pre>${n}</pre></details>
    </div>
  `}function L(i=[]){const t=document.getElementById("sidebar-main");if(!t)return;t.innerHTML="";const n=document.createElement("button");n.id="generate-btn",n.textContent="Generate Timetable",n.onclick=()=>{const e=h(m);f(e)},t.appendChild(n);const o=document.createElement("div");o.id="slide-list",t.appendChild(o),i.length?i.forEach(e=>{const r=document.createElement("div");r.className="slide-item";const s=document.createElement("h3");s.className="slide-item__title",s.textContent=e.title||"(Untitled Slide)";const a=document.createElement("ul");a.className="slide-item__content",e.content.forEach(l=>{const d=document.createElement("li");d.textContent=l,a.appendChild(d)}),r.appendChild(s),r.appendChild(a),o.appendChild(r)}):o.innerHTML="<p>No slides found on the current page.</p>"}function f(i){c=i;const t=document.getElementById("sidebar-main");if(!t)return;const n=document.createElement("h3");n.innerHTML=`Timetable (Total: ${i.totalDuration} mins)`;const o=document.createElement("button");o.id="export-btn",o.textContent="Export to CSV",o.onclick=()=>{if(!c)return;const r=y(c),s=`gamma-timetable-${new Date().toISOString().slice(0,10)}.csv`;E(s,r)},t.innerHTML="",t.appendChild(n),t.appendChild(o),i.items.forEach(r=>{const s=document.createElement("div");s.className="slide-item";let a="";r.content.forEach(l=>{a+=`<p>${l.text}</p>`,l.subItems&&l.subItems.length>0&&(a+='<ul class="sub-items-list">',l.subItems.forEach(d=>{a+=`<li class="sub-item">${d}</li>`}),a+="</ul>")}),s.innerHTML=`
      <div style="display: flex; justify-content: space-between; align-items: baseline;">
        <h3 class="slide-item__title">${r.title}</h3>
        <div>
          <span style="font-size: 12px; color: #6b7280;">${r.startTime} - ${r.endTime}</span>
          <input type="number" value="${r.duration}" min="1" style="width: 40px; margin-left: 8px;" data-id="${r.id}" class="duration-input">
          <span style="font-size: 12px; color: #6b7280;">min</span>
        </div>
      </div>
      <div class="slide-item__content">
        ${a}
      </div>
    `,t.appendChild(s)}),t.querySelectorAll(".duration-input").forEach(r=>{r.addEventListener("change",w)})}const D=S(()=>{c&&T(b(),c)},500);function w(i){const t=i.target.getAttribute("data-id"),n=parseInt(i.target.value,10);if(c){const o=c.items.find(e=>e.id===t);if(o){o.duration=n;const e=h(c.items,{startTime:c.startTime});f(e),D()}}}document.addEventListener("DOMContentLoaded",async()=>{const i=document.getElementById("version-display"),t=document.getElementById("sidebar-footer");i&&(i.textContent=`v${C}`);const n=(e=[])=>{m=e||[],L(m),t&&(t.innerHTML=$(e))},o=await v(b());o?f(o):chrome.runtime.sendMessage({type:"REQUEST_GAMMA_SLIDES"},e=>{u=!0,n(e==null?void 0:e.slides)}),chrome.runtime.onMessage.addListener((e,r,s)=>{e.type==="GAMMA_SLIDES"&&Array.isArray(e.slides)&&(u=!0,n(e.slides))})});
